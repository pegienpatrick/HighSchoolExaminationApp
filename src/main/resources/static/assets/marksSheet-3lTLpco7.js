import{_ as J,X as P,r as k,Y as b,c as h,b as e,w as t,o as d,B as s,t as v,u,a2 as C,V as Q,F as $,a4 as B,e as T,a as F,Z as E,a6 as D,a3 as K,p as W,m as ee}from"./index-WVhmkmZF.js";import{a as w}from"./axios-G2rPRu76.js";import{V as i,a as n}from"./VRow-qsllNqOU.js";import{a as S,b as j,V as A,c as ae}from"./VCard-TLPCC7Wu.js";import{V as q}from"./VForm-7e7r4mv3.js";import{V as te}from"./VSelect-xmc4eIl2.js";import{V as le}from"./VDialog-XwSz7Qfd.js";import{V as oe}from"./VSpacer-yeo1sLfS.js";import{V as re}from"./VCheckbox-boOEk4_c.js";import{V as O}from"./VTextField-I18sYzb4.js";import{V as ue}from"./VDataTable-GTfkgqep.js";/* empty css              */import"./VAvatar-9kArmvpM.js";import"./VImg-lYzg05eL.js";import"./form-I9H_IUBv.js";import"./forwardRefs-y8pOSn8h.js";import"./VMenu-51ahmtf-.js";import"./index-nMzItfZQ.js";import"./ssrBoot-YNbh2RHJ.js";import"./VDivider-PtOVpCpU.js";import"./VOverlay-RBq8L-PQ.js";import"./easing-imumzmxr.js";import"./lazy-m7CSEHGx.js";import"./VCheckboxBtn--5Nvab94.js";import"./VField-PtAP2JRC.js";import"./VChip-t0IRBmO3.js";import"./VTable-ZCjYzXs_.js";const ne=y=>(W("data-v-0cc5c5a5"),y=y(),ee(),y),se=ne(()=>F("p",null,[F("strong",null,"Marks")],-1)),de={key:0},ie={__name:"marksSheet",setup(y){const z=P();let _=window.location.protocol+"//"+window.location.hostname+":8080",I=z.currentRoute.value.query.exam,N=z.currentRoute.value.query.stage;const V=k({data:[],showForm:!1}),x=k({year:2024,term:"",title:""}),g=k({data:[]}),c=k({data:[],filtered:[],search:""});w.get(_+`/api/v1/examination/viewExamination/${I}`,{headers:{Authorization:b.get("Authorization")}}).then(o=>{x.value=o.data});const m=k({data:[]});let R=[];const p=new Map;w.get(_+"/api/v1/subjectSelection/availableSubjects",{headers:{Authorization:b.get("Authorization")}}).then(o=>{console.log(o),R=o.data,R.forEach(l=>{p.set(l.subjectCode,{subjectName:l.subjectName,subjectRep:l.subjectRep})}),console.log(p),console.log(p.get(101))}),w.get(_+`/api/v1/marks/viewMarksSheet/${I}/${N}`,{headers:{Authorization:b.get("Authorization")}}).then(o=>{console.log(o);var a=Object.keys(o.data[0]);console.log(a);for(var l=0;l<a.length-1;l++)m.value.data.push({title:a[l],value:a[l],align:"center",showable:!0});for(var a=Object.keys(o.data[0].marks),l=0;l<a.length;l++)m.value.data.push({title:p.get(parseInt(a[l])).subjectName+"("+a[l]+")",value:a[l],showable:!0});console.log(m.value.data),c.value.data=o.data,c.value.filtered=o.data,V.value.data=m});const Y=o=>{let l=[];for(const a in o)if(a!="marks")l.push({value:o[a],key:a,type:1});else for(const r in o[a])l.push({value:o[a][r],key:r,type:2});return l},H=o=>{w.put(_+"/api/v1/marks/updateMarks",o,{headers:{Authorization:b.get("Authorization")}}).then(l=>{console.log(l)}).catch(l=>{console.log(l),g.value.data.push(o)})},L=async()=>{for(var o=[],l=0;l<g.value.data.length;l++){const a=g.value.data[l];try{const r=await w.put(_+"/api/v1/marks/updateMarks",a,{headers:{Authorization:b.get("Authorization")}});(r.status===200||r.ok)&&o.push(l)}catch(r){console.error(r)}}o.reverse().forEach(a=>{g.value.data.splice(a,1)})},U=(o,l,a)=>{X(o,l,a)},X=(o,l,a)=>{const r=a==="up"?o-1:o+1;if(r>=0&&r<c.value.filtered.length){const f=`input[data-index="${r}"][data-column="${l}"]`,M=document.querySelector(f);M&&M.focus()}},Z=()=>{V.value.showForm=!0},G=()=>{V.value.showForm=!1};return(o,l)=>(d(),h("div",null,[e(i,null,{default:t(()=>[e(n,null,{default:t(()=>[e(S,null,{default:t(()=>[e(j,null,{default:t(()=>[s(" Exarm Information ")]),_:1}),e(A,null,{default:t(()=>[e(q,null,{default:t(()=>[e(i,null,{default:t(()=>[e(n,{md:"6",cols:"12"},{default:t(()=>[s(v(u(x).title),1)]),_:1}),e(n,{md:"6",cols:"12"},{default:t(()=>[s(" Year : "+v(u(x).year),1)]),_:1}),e(n,{md:"6",cols:"12"},{default:t(()=>[s(" Form "+v(u(N)),1)]),_:1}),e(n,{md:"6",cols:"12"},{default:t(()=>[s(" Term "+v(u(x).term),1)]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(n,null,{default:t(()=>[e(te,{label:"Stream",placeholder:"Select Stream",items:["All","A","B","C"],value:"All"})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(n,null,{default:t(()=>[e(S,null,{default:t(()=>[e(j,null,{default:t(()=>[e(i,null,{default:t(()=>[e(n,null,{default:t(()=>[se]),_:1}),e(n,null,{default:t(()=>[e(i,null,{default:t(()=>[s(v(u(g).data.length)+" Unsaved Changes ",1)]),_:1}),e(i,null,{default:t(()=>[e(C,{text:"Save Changes",onClick:L})]),_:1})]),_:1}),e(n,null,{default:t(()=>[e(C,{color:"success",onClick:Z},{default:t(()=>[s("viewable Columns")]),_:1})]),_:1})]),_:1})]),_:1}),e(le,{modelValue:u(V).showForm,"onUpdate:modelValue":l[0]||(l[0]=a=>u(V).showForm=a),"max-width":"600"},{default:t(()=>[e(S,null,{default:t(()=>[e(j,null,{default:t(()=>[s(" Form "),e(oe),e(C,{icon:"",onClick:G},{default:t(()=>[e(Q,null,{default:t(()=>[s("mdi-close")]),_:1})]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(q,null,{default:t(()=>[(d(!0),h($,null,B(u(m).data,a=>(d(),T(i,{key:a.value},{default:t(()=>[F("span",null,[e(re,{label:a.title,"v-text":a.title,modelValue:a.showable,"onUpdate:modelValue":r=>a.showable=r},null,8,["label","v-text","modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(C,{onClick:o.submitForm},{default:t(()=>[s("Submit")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(A,null,{default:t(()=>[e(n,null,{default:t(()=>[e(O,{modelValue:u(c).search,"onUpdate:modelValue":l[1]||(l[1]=a=>u(c).search=a),label:"Search",clearable:""},null,8,["modelValue"])]),_:1}),e(ue,{items:u(c).filtered,search:u(c).search,class:"elevation-1",striped:"","items-per-page":50,headers:u(m).data},{item:t(({item:a})=>[(d(),h("tr",{key:a.admNo},[(d(!0),h($,null,B(Y(a),r=>(d(),h("td",{key:r.key,align:"center",width:160,dense:"",style:{"inline-size":"2rem"}},[r.type===1?(d(),h("span",de,v(r.value),1)):E("",!0),r.type===2?(d(),T(O,{key:1,modelValue:r.value.marks,"onUpdate:modelValue":f=>r.value.marks=f,placeholder:u(p).get(r.value.subjectCode).subjectRep,class:"w-100 inputMarks",label:u(p).get(r.value.subjectCode).subjectRep,onChange:f=>H(r.value),onKeydown:[D(K(f=>U(a.admNo,r.key,"up"),["prevent"]),["up"]),D(K(f=>U(a.admNo,r.key,"down"),["prevent"]),["down"])],"data-index":a.admNo,"data-column":r.key},null,8,["modelValue","onUpdate:modelValue","placeholder","label","onChange","onKeydown","data-index","data-column"])):E("",!0)]))),128))]))]),_:1},8,["items","search","headers"])]),_:1})]),_:1})]),_:1})]),_:1})]))}},Te=J(ie,[["__scopeId","data-v-0cc5c5a5"]]);export{Te as default};
