import{a as b}from"./axios-G2rPRu76.js";import{_ as X,Q as Y,r as g,R as V,c as k,n as e,m as a,o as c,a2 as i,u as o,V as B,b as d,t as x,F as L,a4 as D,l as H,a as z,Z as j,W as Z,X as J}from"./index-Cp0a3j5Z.js";import{V as m,a as u}from"./VRow-e59EUwGS.js";import{V as K}from"./VLabel-X25Up-Eg.js";import{a as R,b as F,V as $}from"./VCard-f1nee6yo.js";import{V as P}from"./VForm-vHiLR6LN.js";import{V as ee}from"./VSelect-Jx7iHon2.js";import{V as ae}from"./VDialog-xBvQGnoj.js";import{V as te}from"./VCheckbox-XJAyhic4.js";import{V as q}from"./VTextField-74eHDJAa.js";import{V as le}from"./VDataTable-wuuS0jak.js";/* empty css              */import"./VAvatar-MKe1hS_I.js";import"./VImg-xuUNPkdI.js";import"./form-xXdqDCjs.js";import"./forwardRefs-y8pOSn8h.js";import"./VMenu-RzLdOBfR.js";import"./index-ogFRjp9r.js";import"./ssrBoot-DBy9na19.js";import"./VDivider-t6YFHrqH.js";import"./VOverlay-x4J7jcA1.js";import"./easing-Apq16fr0.js";import"./lazy-Pl5wsFII.js";import"./dialog-transition-VPrIJniv.js";import"./VCheckboxBtn-z-5o5nyt.js";import"./VChip-8MtU5gPv.js";import"./VField-thFyAEi-.js";import"./VTable-Tng2Nuci.js";const oe=S=>(Z("data-v-90bd33ba"),S=S(),J(),S),se=oe(()=>z("p",null,[z("strong",null,"Marks")],-1)),re={key:0},ue={__name:"editMarksSheet",setup(S){const p=Y();let _=window.location.protocol+"//"+window.location.hostname+":8080",f=p.currentRoute.value.query.exam,h=p.currentRoute.value.query.stage;const w=g({data:"All"}),y=g({data:[],showForm:!1}),U=g({year:2024,term:"",title:""}),C=g({data:[]}),v=g({data:[],filtered:[],search:""});b.get(_+`/api/v1/examination/viewExamination/${f}`,{headers:{Authorization:V.get("Authorization")}}).then(s=>{U.value=s.data});const n=g({data:[],visible:[]});let I=[];const A=new Map;b.get(_+"/api/v1/subjectSelection/availableSubjects",{headers:{Authorization:V.get("Authorization")}}).then(s=>{console.log(s),I=s.data,I.forEach(l=>{A.set(l.subjectCode,{subjectName:l.subjectName,subjectRep:l.subjectRep})}),console.log(A),console.log(A.get(101))}),b.get(_+`/api/v1/marks/viewMarksSheet/${f}/${h}`,{headers:{Authorization:V.get("Authorization")}}).then(s=>{console.log(s);var t=Object.keys(s.data[0]);console.log(t);for(var l=0;l<t.length-1;l++)t[l]!="examination"&&n.value.data.push({title:t[l],value:t[l],align:"center",show:!0,type:1,key:t[l]});for(var t=Object.keys(s.data[0].marks),l=0;l<t.length;l++)n.value.data.push({title:A.get(parseInt(t[l])).subjectName+"("+t[l]+")",value:t[l],show:!1,type:2,key:"marks."+t[l]+".marks"});console.log(n.value.data),v.value.data=s.data,v.value.filtered=s.data,y.value.data=n,E()});const O=s=>{b.put(_+"/api/v1/marks/updateMarks",s,{headers:{Authorization:V.get("Authorization")}}).then(l=>{console.log(l)}).catch(l=>{console.log(l),C.value.data.push(s)})},G=async()=>{for(var s=[],l=0;l<C.value.data.length;l++){const t=C.value.data[l];try{const r=await b.put(_+"/api/v1/marks/updateMarks",t,{headers:{Authorization:V.get("Authorization")}});(r.status===200||r.ok)&&s.push(l)}catch(r){console.error(r)}}s.reverse().forEach(t=>{C.value.data.splice(t,1)})},Q=()=>{y.value.showForm=!0},M=()=>{y.value.showForm=!1},E=()=>{n.value.visible=[];for(const s in n.value.data)n.value.data[s].show&&n.value.visible.push(n.value.data[s]);console.log(n.value.visible)},W=()=>{M(),E()},N=g({num:null});return(()=>{console.log("Checking User"),b.get(_+"/api/v1/user/checkUser",{headers:{"Content-Type":"application/json",Authorization:V.get("Authorization")}}).then(s=>{N.value=s.data}).catch(s=>{console.log(s),(s.response&&s.response.status===401||s.response.status===403)&&(console.log("Current Path : "+p.currentRoute.value.fullPath),p.currentRoute.value.path!="/register"&&p.currentRoute.value.path!="/forgotPassword"&&p.currentRoute.value.path!="/login"&&p.push("/login"))})})(),(s,l)=>(c(),k("div",null,[e(m,null,{default:a(()=>[e(u,null,{default:a(()=>[e(i,{to:`/viewExam?examinationId=${o(f)}&stage=${o(h)}`,text:"Exam Home"},{default:a(()=>[e(B,{icon:"ri-home-line"}),e(K),d(" Exam Home ")]),_:1},8,["to"])]),_:1}),e(u,null,{default:a(()=>[e(i,{to:`/marksSheet?exam=${o(f)}&stage=${o(h)}`,text:"view Marks"},null,8,["to"])]),_:1}),e(u,null,{default:a(()=>[e(i,{text:"View Merit List",to:`/viewMeritList?exam=${o(f)}&stage=${o(h)}`},null,8,["to"])]),_:1}),e(u,null,{default:a(()=>[e(i,{to:`/generateMeritList?exam=${o(f)}&stage=${o(h)}`,text:"Generate Exam Results"},null,8,["to"])]),_:1}),e(u,null,{default:a(()=>[e(i,{text:"Reports",to:`/viewExamReports?examinationId=${o(f)}&stage=${o(h)}`},null,8,["to"])]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(u,null,{default:a(()=>[e(R,null,{default:a(()=>[e(F,null,{default:a(()=>[d(" Exarm Information ")]),_:1}),e($,null,{default:a(()=>[e(P,null,{default:a(()=>[e(m,null,{default:a(()=>[e(u,{md:"6",cols:"12"},{default:a(()=>[d(x(o(U).title),1)]),_:1}),e(u,{md:"6",cols:"12"},{default:a(()=>[d(" Year : "+x(o(U).year),1)]),_:1}),e(u,{md:"6",cols:"12"},{default:a(()=>[d(" Form "+x(o(h)),1)]),_:1}),e(u,{md:"6",cols:"12"},{default:a(()=>[d(" Term "+x(o(U).term),1)]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(u,null,{default:a(()=>[e(ee,{label:"Stream",placeholder:"Select Stream",items:["All","A","B","C"],value:"All",modelValue:o(w).data,"onUpdate:modelValue":l[0]||(l[0]=t=>o(w).data=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(m,null,{default:a(()=>[e(u,null,{default:a(()=>[e(R,null,{default:a(()=>[e(F,null,{default:a(()=>[e(m,null,{default:a(()=>[e(u,null,{default:a(()=>[se,d("(Auto Saving) ")]),_:1}),e(u,null,{default:a(()=>[e(m,null,{default:a(()=>[d(x(o(C).data.length)+" Unsaved Changes ",1)]),_:1}),e(m,null,{default:a(()=>[e(i,{text:"Save unsaved Updates",onClick:G})]),_:1})]),_:1}),e(u,null,{default:a(()=>[e(i,{color:"success",onClick:Q},{default:a(()=>[d("viewable Columns")]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{modelValue:o(y).showForm,"onUpdate:modelValue":l[1]||(l[1]=t=>o(y).showForm=t),"max-width":"600"},{default:a(()=>[e(R,null,{default:a(()=>[e(F,null,{default:a(()=>[d(" Form "),e(i,{icon:"",onClick:M,style:{float:"inline-end"},color:"error"},{default:a(()=>[e(B,null,{default:a(()=>[d("ri-close-line")]),_:1})]),_:1})]),_:1}),e($,null,{default:a(()=>[e(P,null,{default:a(()=>[(c(!0),k(L,null,D(o(n).data,t=>(c(),H(m,{key:t.value},{default:a(()=>[z("span",null,[e(te,{label:t.title,"v-text":t.title,modelValue:t.show,"onUpdate:modelValue":r=>t.show=r},null,8,["label","v-text","modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),_:1})]),_:1}),e(i,{onClick:W,color:"primary",bg:"success","background-color":"primary",text:"Submit"})]),_:1})]),_:1},8,["modelValue"]),e($,null,{default:a(()=>[e(u,null,{default:a(()=>[e(q,{modelValue:o(v).search,"onUpdate:modelValue":l[2]||(l[2]=t=>o(v).search=t),label:"Search",clearable:""},null,8,["modelValue"])]),_:1}),e(le,{items:o(v).filtered,search:o(v).search,class:"elevation-1",striped:"","items-per-page":o(w).data=="All"?10:o(v).filtered.length,headers:o(n).visible},{item:a(({item:t})=>[o(w).data=="All"||o(w).data==t.stream?(c(),k("tr",{key:t.admNo},[(c(!0),k(L,null,D(o(n).visible,r=>(c(),k("td",{key:r.key,align:"center",width:160,dense:"",style:{"inline-size":"2rem"}},[r.type==1?(c(),k("span",re,x(t[r.key]),1)):j("",!0),r.type==2?(c(),H(q,{key:1,modelValue:t.marks[r.value].marks,"onUpdate:modelValue":T=>t.marks[r.value].marks=T,"bg-color":t.marks[r.value].subjectTeacher==o(N).num?"white":"#EF9A9A",label:o(A).get(t.marks[r.value].subjectCode).subjectRep+"("+t.admNo+")",onChange:T=>O(t.marks[r.value]),type:"number",step:".001"},null,8,["modelValue","onUpdate:modelValue","bg-color","label","onChange"])):j("",!0)]))),128))])):j("",!0)]),_:1},8,["items","search","items-per-page","headers"])]),_:1})]),_:1})]),_:1})]),_:1})]))}},Ne=X(ue,[["__scopeId","data-v-90bd33ba"]]);export{Ne as default};
