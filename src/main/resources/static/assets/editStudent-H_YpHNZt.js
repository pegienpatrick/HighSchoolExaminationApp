import{a as h}from"./axios-G2rPRu76.js";import{Q as P,r as m,R as y,c as j,n as e,m as s,F as G,o as N,a as i,t as S,u as o,l as D,Z as O,b as w,a2 as _,V as C,a1 as L}from"./index-WKjbL8T9.js";import{_ as Y}from"./GuardiansForm-J8j3qz07.js";import{V as E,a as n}from"./VRow-OVTj2QZh.js";import{V as q}from"./VAlert-3a85JbQ9.js";import{a as F,V as x,b as J}from"./VCard-7Z-Nhb6D.js";import{V as K}from"./VAvatar-CH2A0OSR.js";import{V as H}from"./VDivider-waA0KO__.js";import{V as Q}from"./VForm-6aTEnKMd.js";import{V as u}from"./VTextField-IrLm8OWS.js";import{V as I}from"./VSelect-OHkD6uXj.js";import"./VDialog-FOl7RVUN.js";import"./VOverlay-TBYimdhT.js";import"./easing-Apq16fr0.js";import"./lazy-b-hiN5pE.js";import"./VImg-mBLNfk7f.js";import"./forwardRefs-y8pOSn8h.js";import"./dialog-transition-ndbJkIK2.js";import"./VTable-uXecweGY.js";/* empty css              */import"./form-y8kNbNCk.js";import"./VField-zZ1l0zML.js";import"./index-o85Hqk3v.js";import"./VLabel-ll7gtFfh.js";import"./VInput-9aEGepXD.js";import"./VMenu-QfTuqrl7.js";import"./ssrBoot-WNY3uwVA.js";import"./VCheckboxBtn-G-nkP6-g.js";import"./VChip-nPbsihEe.js";const Z={class:"text-h6 font-weight-semibold text-error"},W={class:"d-flex flex-column justify-center gap-5"},X={class:"d-flex flex-wrap gap-2"},ee=i("span",{class:"d-none d-sm-block"},"Select new photo",-1),te=i("span",{class:"d-none d-sm-block"},"Reset",-1),ae=i("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1),oe={class:"d-none d-sm-block"},Fe={__name:"editStudent",setup(le){const $=P(),k={admNo:"",surname:"",firstName:"",otherName:"",dateOfBirth:"",birthCertno:"",ifmisNo:"",gender:"",stream:"",stage:"",kcpeMarks:"",cohort:""},d=m({registerError:"",dateOfBirth:""});let g=!1;const V=m(),l=m(structuredClone(k));m(!1);const z=r=>{const t=new FileReader,{files:a}=r.target;a&&a.length&&(t.readAsDataURL(a[0]),t.onload=()=>{typeof t.result=="string"&&(l.value.avatarImg=t.result)})},U=()=>{l.value.avatarImg=k.avatarImg};let v=window.location.protocol+"//"+window.location.hostname+":8080";const M=m({admNo:"",name:""}),b=$.currentRoute.value.query.admNo;let p=m({data:0});const R=async()=>{if(console.log(l.value.gender),l.value.gender==""||l.value.gender==null){d.value.registerError="You must select gender";return}g=!0,l.value.dateOfBirth=new Date(d.value.dateOfBirth);try{const r=await h.put(v+`/api/v1/student/updateStudent/${b}`,l.value,{headers:{"Content-Type":"application/json",Authorization:y.get("Authorization")}});g=!1,d.value.registerError="",console.log(M),p.value.data=new Date().getTime(),setTimeout(()=>{p.value.data=0},3e3),console.log("Success:",r.data)}catch(r){if(p.value.data=0,g=!1,console.log(r.response),d.value.registerError=r.response.data,r.response.status==403&&window.open("/","_blank"),r.response.status==400)try{d.value.registerError="";for(const[t,a]of Object.entries(JSON.parse(r.response.data.message).fielderrors))d.value.registerError+=` ${a}
`}catch{d.value.registerError=r.response.data}else d.value.registerError=r.response.data;console.log(d.value.registerError)}};h.get(v+`/api/v1/student/viewStudent/${b}`,{headers:{Authorization:y.get("Authorization")}}).then(r=>{console.log(r);var t=r.data.body;console.log(t);const a=new Date(t.dateOfBirth),f=String(a.getDate()).padStart(2,"0"),B=String(a.getMonth()+1).padStart(2,"0"),A=a.getFullYear();t.dateOfBirth=`${f}-${B}-${A}`,d.value.dateOfBirth=`${A}-${B}-${f}`,console.log(d.value.dateOfBirth),l.value=t}).catch(r=>{console.error("Error fetching student details:",r),console.log(r),r.response&&(r.response.status===401||r.response.status===403)&&window.open("/login","_blank")}),h.get(v+`/api/v1/studentPhoto/getStudentPhoto/${b}`,{responseType:"blob",headers:{Authorization:y.get("Authorization")}}).then(r=>{const t=new Blob([r.data],{type:"application/png"});k.avatarImg=URL.createObjectURL(t),U()});const c=m({success:!1}),T=()=>{console.log(V.value.value);const r=new FormData;r.append("file",V.value.files[0]),console.log(Object.keys(r)),console.log(Object.values(r)),h.post(v+`/api/v1/studentPhoto/uploadStudentPhoto/${b}`,r,{headers:{"Content-Type":"multipart/form-data",Authorization:y.get("Authorization")}}).then(t=>{c.value.success=!0,window.setTimeout(()=>{c.value.success=!1},3e3)})};return(r,t)=>(N(),j(G,null,[e(E,null,{default:s(()=>[e(n,{cols:"12",class:"text-center"},{default:s(()=>[i("p",Z,S(o(d).registerError),1)]),_:1}),o(g)?(N(),D(L,{key:0,indeterminate:"",color:"blue",size:"24",style:{position:"absolute","inset-block-start":"50%","inset-inline-start":"50%",transform:"translate(-50%, -50%)"}})):O("",!0),o(p).data>0?(N(),D(q,{key:1},{default:s(()=>[w(" Updated Successsfully ")]),_:1})):O("",!0),e(n,{cols:"12"},{default:s(()=>[e(F,{title:"Edit Student Details"},{default:s(()=>[e(x,{class:"d-flex"},{default:s(()=>[e(K,{rounded:"lg",size:"100",class:"me-6",image:o(l).avatarImg},null,8,["image"]),i("form",W,[i("div",X,[e(_,{color:"primary",onClick:t[0]||(t[0]=a=>{var f;return(f=o(V))==null?void 0:f.click()}),variant:"outlined"},{default:s(()=>[e(C,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),ee]),_:1}),i("input",{ref_key:"refInputEl",ref:V,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:z},null,544),e(_,{type:"reset",color:"error",variant:"outlined",onClick:U},{default:s(()=>[te,e(C,{icon:"ri-refresh-line",class:"d-sm-none"})]),_:1})]),ae,e(_,{color:o(c).success?"success":"primary",onClick:T,modelValue:o(c).success,"onUpdate:modelValue":t[1]||(t[1]=a=>o(c).success=a)},{default:s(()=>[e(C,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),i("span",oe,S(o(c).success?"Uploaded Successfully":"Upload photo"),1)]),_:1},8,["color","modelValue"])])]),_:1}),e(H),e(x,{class:"d-flex"},{default:s(()=>[e(Q,{class:"mt-6"},{default:s(()=>[e(E,null,{default:s(()=>[e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).admNo,"onUpdate:modelValue":t[2]||(t[2]=a=>o(l).admNo=a),label:"Admission Number",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).surname,"onUpdate:modelValue":t[3]||(t[3]=a=>o(l).surname=a),label:"Surname"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).firstName,"onUpdate:modelValue":t[4]||(t[4]=a=>o(l).firstName=a),label:"First Name"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).otherName,"onUpdate:modelValue":t[5]||(t[5]=a=>o(l).otherName=a),label:"Other Name"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(d).dateOfBirth,"onUpdate:modelValue":t[6]||(t[6]=a=>o(d).dateOfBirth=a),label:"Date of Birth",type:"date",placeholder:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(I,{modelValue:o(l).gender,"onUpdate:modelValue":t[7]||(t[7]=a=>o(l).gender=a),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).birthCertno,"onUpdate:modelValue":t[8]||(t[8]=a=>o(l).birthCertno=a),label:"Birth Certificate Number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).ifmisNo,"onUpdate:modelValue":t[9]||(t[9]=a=>o(l).ifmisNo=a),label:"NEMIS Number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).stage,"onUpdate:modelValue":t[10]||(t[10]=a=>o(l).stage=a),label:"Stage (Form)",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(I,{modelValue:o(l).stream,"onUpdate:modelValue":t[11]||(t[11]=a=>o(l).stream=a),label:"Stream",items:["A","B","C"]},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).kcpeMarks,"onUpdate:modelValue":t[12]||(t[12]=a=>o(l).kcpeMarks=a),label:"KCPE Marks",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:o(l).cohort,"onUpdate:modelValue":t[13]||(t[13]=a=>o(l).cohort=a),label:"Cohort",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:s(()=>[e(_,{onClick:R,color:o(p).data?"success":"primary"},{default:s(()=>[w(S(o(p).data?"Saved Successfully":"Save Changes"),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(E,null,{default:s(()=>[e(n,null,{default:s(()=>[e(F,null,{default:s(()=>[e(J,null,{default:s(()=>[w(" Guardians ")]),_:1}),e(x,null,{default:s(()=>[e(Y)]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{Fe as default};
