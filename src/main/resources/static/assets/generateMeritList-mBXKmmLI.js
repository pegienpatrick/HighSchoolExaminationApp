import{a as v}from"./axios-G2rPRu76.js";import{_ as $,X as M,r as w,Y as h,c as R,b as a,w as i,o as L,a2 as m,u as l,V as E,B}from"./index-SGO5OOPy.js";import{V,a as c}from"./VRow-SKQ4CCOT.js";import{V as z}from"./VField-JCquXGl7.js";import{V as I}from"./VSelect-XRxo3SYo.js";import{V as N}from"./VTextField-zjRFJMH_.js";import{V as y}from"./VDataTable-3nZzmSqx.js";/* empty css              */import"./index-vWDdzW97.js";import"./VImg-nJ6DsKWr.js";import"./form-syYsj1LP.js";import"./easing-Apq16fr0.js";import"./forwardRefs-y8pOSn8h.js";import"./VMenu-Jk-FC-iD.js";import"./ssrBoot-dRiIKdbQ.js";import"./VAvatar-aQ_KeIL1.js";import"./VDivider-J_lD5GQp.js";import"./VOverlay-sta7PfT3.js";import"./lazy-Dwtquv-K.js";import"./dialog-transition-H9M13_Jl.js";import"./VCheckboxBtn-N82T6j1u.js";import"./VChip-AExESlP7.js";import"./VTable-GWFtDMSE.js";const T={__name:"generateMeritList",setup(U){const x=M(),e=w({data:[],headers:[],search:""});let p=window.location.protocol+"//"+window.location.hostname+":8080",u=x.currentRoute.value.query.exam,n=x.currentRoute.value.query.stage,_=[],f=[],g=[],b=[],A=[];const d=new Map;v.get(p+"/api/v1/subjectSelection/availableSubjects",{headers:{Authorization:h.get("Authorization")}}).then(t=>{console.log(t),A=t.data,A.forEach(o=>{d.set(o.subjectCode,{subjectName:o.subjectName,subjectRep:o.subjectRep})}),console.log(d),console.log(d.get(101))}),v.get(p+`/api/v1/meritList/generate/${u}/${n}`,{headers:{"Content-Type":"application/json",Authorization:h.get("Authorization")}}).then(t=>{console.log(t);let o=t.data;_=o,e.value.data=o,e.value.headers=[{title:"Overall Pos",value:"classRank"},{title:"Stream",value:"stream"},{title:"Stream Pos",value:"streamRank"},{title:"Adm No",value:"admNo"},{title:"Student Name",value:"studentName"}],d.forEach((r,S)=>{e.value.headers.push({title:d.get(S).subjectRep,value:"subjectMarks."+S}),e.value.headers.push({title:"G",value:"subjectGrades."+S})}),e.value.headers.push({title:"Aggr Points",value:"points"}),e.value.headers.push({title:"Aggr Grade",value:"aggregateGrade"}),e.value.headers.push({title:"Entry Marks",value:"kcpeMarks"}),console.log(e.value.headers)}).catch(t=>{console.log(t),(t.response&&t.response.status===401||t.response.status===403)&&window.open("/login","_blank")});let j="";const s=w({selectedStream:"All"}),k=()=>{if(e.value.data=[],s.value.selectedStream=="All"){e.value.data=_;return}if(s.value.selectedStream=="A"&&f.length>0){e.value.data=f;return}if(s.value.selectedStream=="B"&&g.length>0){e.value.data=g;return}if(s.value.selectedStream=="C"&&b.length>0){e.value.data=b;return}v.get(p+`/api/v1/meritList/viewMerit/${u}/${n}?stream=${s.value.selectedStream}`,{headers:{"Content-Type":"application/json",Authorization:h.get("Authorization")}}).then(t=>{e.value.data=t.data,s.value.selectedStream=="A"&&(f=t.data),s.value.selectedStream=="B"&&(g=t.data),s.value.selectedStream=="C"&&(b=t.data)})},C=()=>{v.get(p+`/api/v1/meritList/printMerit/${u}/${n}?stream=${s.value.selectedStream}`,{responseType:"blob",headers:{Authorization:h.get("Authorization")}}).then(t=>{const o=new Blob([t.data],{type:"application/pdf"}),r=document.createElement("a");r.href=URL.createObjectURL(o),r.download=n+s.value.selectedStream+u+" MeritList.pdf",document.body.appendChild(r),r.click(),document.body.removeChild(r)})};return(t,o)=>(L(),R("div",null,[a(V,null,{default:i(()=>[a(c,null,{default:i(()=>[a(m,{to:`/viewExam?examinationId=${l(u)}&stage=${l(n)}`,text:"Exam Home"},{default:i(()=>[a(E,{icon:"ri-home-line"}),a(z),B(" Exam Home ")]),_:1},8,["to"])]),_:1}),a(c,null,{default:i(()=>[a(m,{to:`/marksSheet?exam=${l(u)}&stage=${l(n)}`,text:"Edit Marks"},null,8,["to"])]),_:1}),a(c,null,{default:i(()=>[a(m,{text:"Reports",to:`/viewExamReports?examinationId=${l(u)}&stage=${l(n)}`},null,8,["to"])]),_:1})]),_:1}),a(V,null,{default:i(()=>[a(c,null,{default:i(()=>[a(I,{label:"Select Stream ",items:["All","A","B","C"],modelValue:l(s).selectedStream,"onUpdate:modelValue":o[0]||(o[0]=r=>l(s).selectedStream=r)},null,8,["modelValue"])]),_:1}),a(c,null,{default:i(()=>[a(m,{text:"Fetch Stream MeritList",onClick:k})]),_:1}),a(m,{text:"Download",onClick:C})]),_:1}),a(V,null,{default:i(()=>[a(N,{modelValue:l(e).search,"onUpdate:modelValue":o[1]||(o[1]=r=>l(e).search=r),label:"Search",onInput:l(j)},null,8,["modelValue","onInput"]),a(y,{items:l(e).data,class:"elevation-1 custom-table",striped:"",search:l(e).search,headers:l(e).headers},null,8,["items","search","headers"])]),_:1})]))}},ne=$(T,[["__scopeId","data-v-74542a00"]]);export{ne as default};
