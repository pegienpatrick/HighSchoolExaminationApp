import{a as S}from"./axios-G2rPRu76.js";import{D as L,L as Y,a7 as q,r as b,a8 as H,k as D,a9 as j,z as W,W as G,R as J,b as e,aa as K,ab as X,X as P,l as Z,o as C,c as U,w as r,a2 as _,u as o,B as E,a as i,F as z,a4 as Q,t as w,Y as k,e as R,Z as T,a1 as ee}from"./index-o3g7j-pu.js";import{a as d,V as x}from"./VRow-6qMY-zIc.js";import{m as le,u as te,V as $}from"./VOverlay-AuJcsXDy.js";import{f as ae}from"./forwardRefs-y8pOSn8h.js";import{e as oe}from"./VMenu-cCGLK3cW.js";import{a as O,b as I,V as M}from"./VCard-Pw8zZ9F3.js";import{V as c}from"./VTextField-hSvIFRYb.js";import{V as A}from"./VSelect-N7PvZ0d2.js";import{V as re}from"./VTable-l_BT_Ovi.js";import{V as ne}from"./VAlert-wiIZc_Io.js";import{V as ue}from"./VForm-jkwPAz19.js";/* empty css              */import"./easing-imumzmxr.js";import"./lazy-hOOnrdiR.js";import"./VImg-FqV0TNDi.js";import"./index-bUpWvayE.js";import"./ssrBoot-MY_GD0BE.js";import"./VAvatar-rbGeQzgj.js";import"./VDivider-sBH1Wu20.js";import"./form-ZbOCXVi8.js";import"./VCheckboxBtn-R6FB8e_f.js";const se=L({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...le({origin:"center center",scrollStrategy:"block",transition:{component:oe},zIndex:2400})},"VDialog"),de=Y()({name:"VDialog",props:se(),emits:{"update:modelValue":g=>!0},setup(g,F){let{slots:V}=F;const t=q(g,"modelValue"),{scopeId:h}=te(),n=b();function v(f){var u,a;const m=f.relatedTarget,p=f.target;if(m!==p&&((u=n.value)!=null&&u.contentEl)&&((a=n.value)!=null&&a.globalTop)&&![document,n.value.contentEl].includes(p)&&!n.value.contentEl.contains(p)){const l=X(n.value.contentEl);if(!l.length)return;const y=l[0],s=l[l.length-1];m===y?s.focus():y.focus()}}H&&D(()=>t.value&&g.retainFocus,f=>{f?document.addEventListener("focusin",v):document.removeEventListener("focusin",v)},{immediate:!0}),D(t,async f=>{var m,p;await j(),f?(m=n.value.contentEl)==null||m.focus({preventScroll:!0}):(p=n.value.activatorEl)==null||p.focus({preventScroll:!0})});const N=W(()=>G({"aria-haspopup":"dialog","aria-expanded":String(t.value)},g.activatorProps));return J(()=>{const f=$.filterProps(g);return e($,G({ref:n,class:["v-dialog",{"v-dialog--fullscreen":g.fullscreen,"v-dialog--scrollable":g.scrollable},g.class],style:g.style},f,{modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,"aria-modal":"true",activatorProps:N.value,role:"dialog"},h),{activator:V.activator,default:function(){for(var m=arguments.length,p=new Array(m),u=0;u<m;u++)p[u]=arguments[u];return e(K,{root:"VDialog"},{default:()=>{var a;return[(a=V.default)==null?void 0:a.call(V,...p)]}})}})}),ae({},n)}}),ie=i("i",{class:"ri-add-circle-line"},null,-1),me={class:"d-flex justify-end"},fe=["v-if"],ce=i("tr",null,[i("th",null," Id "),i("th",null," fullname "),i("th",null," gender "),i("th",null," phone "),i("th",null," email "),i("th",null," relationship "),i("th",null," edit "),i("th",null," remove ")],-1),pe=i("i",{class:"ri-edit-line"},null,-1),Ve={__name:"GuardiansForm",setup(g){let V=P().currentRoute.value.query.admNo;const t=b({showForm:!1,admNo:V,fullName:"",idNo:"",gender:"",phone:"",email:"",relationship:"",editing:!1,num:""}),h=()=>{t.value.showForm=!1},n=()=>{t.value.showForm=!0};let v=window.location.protocol+"//"+window.location.hostname+":8080";const N=b({data:[]}),f=()=>{S.get(v+`/api/v1/guardian/viewStudentGuardians/${V}`,{headers:{Authorization:k.get("Authorization")}}).then(a=>{console.log(a),N.value.data=a.data})};f();const m=()=>{t.value.admNo=V;let a=v+"/api/v1/guardian/addGuardian";t.value.editing==!0&&(a=v+`/api/v1/guardian/updateGuardian/${t.value.num}`),S[t.value.editing==!0?"put":"post"](a,t.value,{headers:{Authorization:k.get("Authorization")}}).then(l=>{console.log(l),N.value.data=l.data,f(),h(),t.value={editing:!1,showForm:!1,admNo:V}}).catch(l=>{console.log(l),alert("error : "+l.response.data)})},p=a=>{console.log(a),t.value=a,t.value.editing=!0,t.admNo=V,console.log(t.value),n()},u=a=>{console.log(a),confirm("Are you sure you want to delete?")&&S.get(v+`/api/v1/guardian/deleteGuardian/${a.num}`,{headers:{Authorization:k.get("Authorization")}}).then(l=>{f()})};return(a,l)=>{const y=Z("VCardBody");return C(),U("div",null,[e(x,null,{default:r(()=>[e(d,null,{default:r(()=>[e(_,{onClick:l[0]||(l[0]=s=>{t.value={},o(t).showForm=!0,o(t).editing=!1}),color:"primary",class:"m-auto d-block"},{default:r(()=>[ie,E(" Add Guardian ")]),_:1})]),_:1}),e(de,{modelValue:o(t).showForm,"onUpdate:modelValue":l[7]||(l[7]=s=>o(t).showForm=s),"max-width":"500px"},{default:r(()=>[e(O,null,{default:r(()=>[e(I,null,{default:r(()=>[E("Add Guardian")]),_:1}),e(y,{class:"p-3"},{default:r(()=>[e(d,null,{default:r(()=>[e(c,{modelValue:o(t).fullName,"onUpdate:modelValue":l[1]||(l[1]=s=>o(t).fullName=s),label:"Guardian Name"},null,8,["modelValue"])]),_:1}),e(d,null,{default:r(()=>[e(c,{modelValue:o(t).idNo,"onUpdate:modelValue":l[2]||(l[2]=s=>o(t).idNo=s),label:"Guardian Id"},null,8,["modelValue"])]),_:1}),e(d,null,{default:r(()=>[e(c,{modelValue:o(t).email,"onUpdate:modelValue":l[3]||(l[3]=s=>o(t).email=s),label:"Guardian Email",type:"email"},null,8,["modelValue"])]),_:1}),e(d,null,{default:r(()=>[e(c,{modelValue:o(t).phone,"onUpdate:modelValue":l[4]||(l[4]=s=>o(t).phone=s),label:"Guardian Phone",type:"tel"},null,8,["modelValue"])]),_:1}),e(d,null,{default:r(()=>[e(A,{modelValue:o(t).gender,"onUpdate:modelValue":l[5]||(l[5]=s=>o(t).gender=s),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(d,null,{default:r(()=>[e(A,{modelValue:o(t).relationship,"onUpdate:modelValue":l[6]||(l[6]=s=>o(t).relationship=s),label:"Relationship",items:["FATHER","MOTHER","SPONSOR","OTHER"],placeholder:"Select Relationship",required:""},null,8,["modelValue"])]),_:1}),i("div",me,[e(_,{onClick:m},{default:r(()=>[E("Submit")]),_:1}),e(_,{onClick:h},{default:r(()=>[E("Cancel")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(re,null,{default:r(()=>[i("tbody",{"v-if":o(N).data!=null},[ce,(C(!0),U(z,null,Q(o(N).data,s=>(C(),U("tr",{key:s.num},[i("td",null,w(s.idNo),1),i("td",null,w(s.fullName),1),i("td",null,w(s.gender),1),i("td",null,w(s.phone),1),i("td",null,w(s.email),1),i("td",null,w(s.relationship),1),i("td",null,[e(_,{text:"edit",icon:"ri-edit-line",onClick:B=>p(s)},{default:r(()=>[pe]),_:2},1032,["onClick"])]),i("td",null,[e(_,{text:"delete",onClick:B=>u(s),icon:"ri-close-line",color:"danger"},null,8,["onClick"])])]))),128))],8,fe)]),_:1})])}}},ge={class:"text-h6 font-weight-semibold text-error"},Me={__name:"editStudent",setup(g){const F=P(),V={admNo:"",surname:"",firstName:"",otherName:"",dateOfBirth:"",birthCertno:"",ifmisNo:"",gender:"",stream:"",stage:"",kcpeMarks:"",cohort:""},t=b({registerError:"",dateOfBirth:""});let h=!1;b();const n=b(structuredClone(V));b(!1);let v=window.location.protocol+"//"+window.location.hostname+":8080";const N=b({admNo:"",name:""}),f=F.currentRoute.value.query.admNo;let m=b({data:0});const p=async()=>{if(console.log(n.value.gender),n.value.gender==""||n.value.gender==null){t.value.registerError="You must select gender";return}h=!0,n.value.dateOfBirth=new Date(t.value.dateOfBirth);try{const u=await S.put(v+`/api/v1/student/updateStudent/${f}`,n.value,{headers:{"Content-Type":"application/json",Authorization:k.get("Authorization")}});h=!1,t.value.registerError="",console.log(N),m.value.data=new Date().getTime(),setTimeout(()=>{m.value.data=0},3e3),console.log("Success:",u.data)}catch(u){if(m.value.data=0,h=!1,console.log(u.response),t.value.registerError=u.response.data,u.response.status==403&&window.open("/","_blank"),u.response.status==400)try{t.value.registerError="";for(const[a,l]of Object.entries(JSON.parse(u.response.data.message).fielderrors))t.value.registerError+=` ${l}
`}catch{t.value.registerError=u.response.data}else t.value.registerError=u.response.data;console.log(t.value.registerError)}};return S.get(v+`/api/v1/student/viewStudent/${f}`,{headers:{Authorization:k.get("Authorization")}}).then(u=>{console.log(u);var a=u.data.body;console.log(a);const l=new Date(a.dateOfBirth),y=String(l.getDate()).padStart(2,"0"),s=String(l.getMonth()+1).padStart(2,"0"),B=l.getFullYear();a.dateOfBirth=`${y}-${s}-${B}`,t.value.dateOfBirth=`${B}-${s}-${y}`,console.log(t.value.dateOfBirth),n.value=a}).catch(u=>{console.error("Error fetching student details:",u),console.log(u),u.response&&(u.response.status===401||u.response.status===403)&&window.open("/login","_blank")}),(u,a)=>(C(),U(z,null,[e(x,null,{default:r(()=>[e(d,{cols:"12",class:"text-center"},{default:r(()=>[i("p",ge,w(o(t).registerError),1)]),_:1}),o(h)?(C(),R(ee,{key:0,indeterminate:"",color:"blue",size:"24",style:{position:"absolute","inset-block-start":"50%","inset-inline-start":"50%",transform:"translate(-50%, -50%)"}})):T("",!0),o(m).data>0?(C(),R(ne,{key:1},{default:r(()=>[E(" Updated Successsfully ")]),_:1})):T("",!0),e(d,{cols:"12"},{default:r(()=>[e(O,{title:"Edit Student Details"},{default:r(()=>[e(M,{class:"d-flex"},{default:r(()=>[e(ue,{class:"mt-6"},{default:r(()=>[e(x,null,{default:r(()=>[e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).admNo,"onUpdate:modelValue":a[0]||(a[0]=l=>o(n).admNo=l),label:"Admission Number",type:"number"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).surname,"onUpdate:modelValue":a[1]||(a[1]=l=>o(n).surname=l),label:"Surname"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).firstName,"onUpdate:modelValue":a[2]||(a[2]=l=>o(n).firstName=l),label:"First Name"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).otherName,"onUpdate:modelValue":a[3]||(a[3]=l=>o(n).otherName=l),label:"Other Name"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(t).dateOfBirth,"onUpdate:modelValue":a[4]||(a[4]=l=>o(t).dateOfBirth=l),label:"Date of Birth",type:"date",placeholder:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(A,{modelValue:o(n).gender,"onUpdate:modelValue":a[5]||(a[5]=l=>o(n).gender=l),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).birthCertno,"onUpdate:modelValue":a[6]||(a[6]=l=>o(n).birthCertno=l),label:"Birth Certificate Number"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).ifmisNo,"onUpdate:modelValue":a[7]||(a[7]=l=>o(n).ifmisNo=l),label:"IFMIS Number"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).stage,"onUpdate:modelValue":a[8]||(a[8]=l=>o(n).stage=l),label:"Stage (Form)",type:"number"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(A,{modelValue:o(n).stream,"onUpdate:modelValue":a[9]||(a[9]=l=>o(n).stream=l),label:"Stream",items:["A","B","C"]},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).kcpeMarks,"onUpdate:modelValue":a[10]||(a[10]=l=>o(n).kcpeMarks=l),label:"KCPE Marks",type:"number"},null,8,["modelValue"])]),_:1}),e(d,{md:"6",cols:"12"},{default:r(()=>[e(c,{modelValue:o(n).cohort,"onUpdate:modelValue":a[11]||(a[11]=l=>o(n).cohort=l),label:"Cohort",type:"number"},null,8,["modelValue"])]),_:1}),e(d,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:r(()=>[e(_,{onClick:p},{default:r(()=>[E("Save Changes")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(x,null,{default:r(()=>[e(d,null,{default:r(()=>[e(O,null,{default:r(()=>[e(I,null,{default:r(()=>[E(" Guardians ")]),_:1}),e(M,null,{default:r(()=>[e(Ve)]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{Me as default};
