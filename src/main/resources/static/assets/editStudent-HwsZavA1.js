import{a as h}from"./axios-G2rPRu76.js";import{X as P,r as m,Y as y,c as j,b as e,w as s,F as G,o as w,a as i,t as A,u as a,e as D,Z as O,B as N,a2 as _,V as S,a1 as L}from"./index-zYAuA0qV.js";import{_ as Y}from"./GuardiansForm-wFgiIAs2.js";import{V as C,a as n}from"./VRow-7mHl22X1.js";import{V as q}from"./VAlert-ukaBu81_.js";import{a as F,V as x,b as J}from"./VCard-Mp1410Mc.js";import{V as K}from"./VAvatar-BX0ZOUQe.js";import{V as H}from"./VDivider-AOx8292S.js";import{V as X}from"./VForm-8SLQ-6iH.js";import{V as u}from"./VTextField-JQu1_MM5.js";import{V as I}from"./VSelect-4nlBnCuk.js";import"./VDialog-3VbpmMDW.js";import"./VOverlay-fwCDSazt.js";import"./easing-Apq16fr0.js";import"./lazy-p-tG6HZU.js";import"./VImg-XJYe2yvh.js";import"./forwardRefs-y8pOSn8h.js";import"./dialog-transition-BhwFHhVk.js";import"./VTable-tqJF_m3V.js";/* empty css              */import"./form-5RZ1SEPf.js";import"./VField-pvgEwNC3.js";import"./index-Dx9PTrLH.js";import"./VLabel-H24OS9-G.js";import"./VMenu-AAQK7vOC.js";import"./ssrBoot-sA4uMkfL.js";import"./VCheckboxBtn-HguwSvFI.js";import"./VChip-LZhjDHi2.js";const Z={class:"text-h6 font-weight-semibold text-error"},Q={class:"d-flex flex-column justify-center gap-5"},W={class:"d-flex flex-wrap gap-2"},ee=i("span",{class:"d-none d-sm-block"},"Select new photo",-1),te=i("span",{class:"d-none d-sm-block"},"Reset",-1),oe=i("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1),ae={class:"d-none d-sm-block"},Oe={__name:"editStudent",setup(le){const $=P(),k={admNo:"",surname:"",firstName:"",otherName:"",dateOfBirth:"",birthCertno:"",ifmisNo:"",gender:"",stream:"",stage:"",kcpeMarks:"",cohort:""},d=m({registerError:"",dateOfBirth:""});let f=!1;const g=m(),l=m(structuredClone(k));m(!1);const z=r=>{const t=new FileReader,{files:o}=r.target;o&&o.length&&(t.readAsDataURL(o[0]),t.onload=()=>{typeof t.result=="string"&&(l.value.avatarImg=t.result)})},B=()=>{l.value.avatarImg=k.avatarImg};let V=window.location.protocol+"//"+window.location.hostname+":8080";const M=m({admNo:"",name:""}),v=$.currentRoute.value.query.admNo;let b=m({data:0});const T=async()=>{if(console.log(l.value.gender),l.value.gender==""||l.value.gender==null){d.value.registerError="You must select gender";return}f=!0,l.value.dateOfBirth=new Date(d.value.dateOfBirth);try{const r=await h.put(V+`/api/v1/student/updateStudent/${v}`,l.value,{headers:{"Content-Type":"application/json",Authorization:y.get("Authorization")}});f=!1,d.value.registerError="",console.log(M),b.value.data=new Date().getTime(),setTimeout(()=>{b.value.data=0},3e3),console.log("Success:",r.data)}catch(r){if(b.value.data=0,f=!1,console.log(r.response),d.value.registerError=r.response.data,r.response.status==403&&window.open("/","_blank"),r.response.status==400)try{d.value.registerError="";for(const[t,o]of Object.entries(JSON.parse(r.response.data.message).fielderrors))d.value.registerError+=` ${o}
`}catch{d.value.registerError=r.response.data}else d.value.registerError=r.response.data;console.log(d.value.registerError)}};h.get(V+`/api/v1/student/viewStudent/${v}`,{headers:{Authorization:y.get("Authorization")}}).then(r=>{console.log(r);var t=r.data.body;console.log(t);const o=new Date(t.dateOfBirth),c=String(o.getDate()).padStart(2,"0"),E=String(o.getMonth()+1).padStart(2,"0"),U=o.getFullYear();t.dateOfBirth=`${c}-${E}-${U}`,d.value.dateOfBirth=`${U}-${E}-${c}`,console.log(d.value.dateOfBirth),l.value=t}).catch(r=>{console.error("Error fetching student details:",r),console.log(r),r.response&&(r.response.status===401||r.response.status===403)&&window.open("/login","_blank")}),h.get(V+`/api/v1/studentPhoto/getStudentPhoto/${v}`,{responseType:"blob",headers:{Authorization:y.get("Authorization")}}).then(r=>{const t=new Blob([r.data],{type:"application/png"});k.avatarImg=URL.createObjectURL(t),B()});const p=m({success:!1}),R=()=>{console.log(g.value.value);const r=new FormData;r.append("file",g.value.files[0]),console.log(Object.keys(r)),console.log(Object.values(r)),h.post(V+`/api/v1/studentPhoto/uploadStudentPhoto/${v}`,r,{headers:{"Content-Type":"multipart/form-data",Authorization:y.get("Authorization")}}).then(t=>{p.value.success=!0,window.setTimeout(()=>{p.value.success=!1},3e3)})};return(r,t)=>(w(),j(G,null,[e(C,null,{default:s(()=>[e(n,{cols:"12",class:"text-center"},{default:s(()=>[i("p",Z,A(a(d).registerError),1)]),_:1}),a(f)?(w(),D(L,{key:0,indeterminate:"",color:"blue",size:"24",style:{position:"absolute","inset-block-start":"50%","inset-inline-start":"50%",transform:"translate(-50%, -50%)"}})):O("",!0),a(b).data>0?(w(),D(q,{key:1},{default:s(()=>[N(" Updated Successsfully ")]),_:1})):O("",!0),e(n,{cols:"12"},{default:s(()=>[e(F,{title:"Edit Student Details"},{default:s(()=>[e(x,{class:"d-flex"},{default:s(()=>[e(K,{rounded:"lg",size:"100",class:"me-6",image:a(l).avatarImg},null,8,["image"]),i("form",Q,[i("div",W,[e(_,{color:"primary",onClick:t[0]||(t[0]=o=>{var c;return(c=a(g))==null?void 0:c.click()}),variant:"outlined"},{default:s(()=>[e(S,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),ee]),_:1}),i("input",{ref_key:"refInputEl",ref:g,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:z},null,544),e(_,{type:"reset",color:"error",variant:"outlined",onClick:B},{default:s(()=>[te,e(S,{icon:"ri-refresh-line",class:"d-sm-none"})]),_:1})]),oe,e(_,{color:a(p).success?"success":"primary",onClick:R,modelValue:a(p).success,"onUpdate:modelValue":t[1]||(t[1]=o=>a(p).success=o)},{default:s(()=>[e(S,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),i("span",ae,A(a(p).success?"Uploaded Successfully":"Upload photo"),1)]),_:1},8,["color","modelValue"])])]),_:1}),e(H),e(x,{class:"d-flex"},{default:s(()=>[e(X,{class:"mt-6"},{default:s(()=>[e(C,null,{default:s(()=>[e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).admNo,"onUpdate:modelValue":t[2]||(t[2]=o=>a(l).admNo=o),label:"Admission Number",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).surname,"onUpdate:modelValue":t[3]||(t[3]=o=>a(l).surname=o),label:"Surname"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).firstName,"onUpdate:modelValue":t[4]||(t[4]=o=>a(l).firstName=o),label:"First Name"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).otherName,"onUpdate:modelValue":t[5]||(t[5]=o=>a(l).otherName=o),label:"Other Name"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(d).dateOfBirth,"onUpdate:modelValue":t[6]||(t[6]=o=>a(d).dateOfBirth=o),label:"Date of Birth",type:"date",placeholder:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(I,{modelValue:a(l).gender,"onUpdate:modelValue":t[7]||(t[7]=o=>a(l).gender=o),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).birthCertno,"onUpdate:modelValue":t[8]||(t[8]=o=>a(l).birthCertno=o),label:"Birth Certificate Number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).ifmisNo,"onUpdate:modelValue":t[9]||(t[9]=o=>a(l).ifmisNo=o),label:"IFMIS Number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).stage,"onUpdate:modelValue":t[10]||(t[10]=o=>a(l).stage=o),label:"Stage (Form)",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(I,{modelValue:a(l).stream,"onUpdate:modelValue":t[11]||(t[11]=o=>a(l).stream=o),label:"Stream",items:["A","B","C"]},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).kcpeMarks,"onUpdate:modelValue":t[12]||(t[12]=o=>a(l).kcpeMarks=o),label:"KCPE Marks",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{md:"6",cols:"12"},{default:s(()=>[e(u,{modelValue:a(l).cohort,"onUpdate:modelValue":t[13]||(t[13]=o=>a(l).cohort=o),label:"Cohort",type:"number"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:s(()=>[e(_,{onClick:T},{default:s(()=>[N("Save Changes")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(C,null,{default:s(()=>[e(n,null,{default:s(()=>[e(F,null,{default:s(()=>[e(J,null,{default:s(()=>[N(" Guardians ")]),_:1}),e(x,null,{default:s(()=>[e(Y)]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{Oe as default};
