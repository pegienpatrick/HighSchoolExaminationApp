import{a as y}from"./axios-G2rPRu76.js";import{X as D,r as p,l as z,o as w,c as S,b as e,w as r,a2 as _,u as t,B as h,a as s,F as M,a4 as I,t as g,Y as C,e as O,Z as G,a1 as L}from"./index-xVnyt9yu.js";import{a as u,V as F}from"./VRow-gHwNWVPx.js";import{V as Y}from"./VDialog-TMqOHhhm.js";import{a as B,b as T,V as $}from"./VCard-sd6GJVRG.js";import{V as m}from"./VTextField-CtPzkPC5.js";import{V as U}from"./VSelect-ILe0HWJq.js";import{V as q}from"./VTable-SC0E6epR.js";import{V as H}from"./VAlert-8V811gph.js";import{V as P}from"./VForm-PYWl0C29.js";/* empty css              */import"./VOverlay-0I2wVsb2.js";import"./easing-imumzmxr.js";import"./lazy-YeCD7kcS.js";import"./VImg-YmpmSzhE.js";import"./forwardRefs-y8pOSn8h.js";import"./VMenu-yxDCCHIV.js";import"./index-yfIYSuHd.js";import"./ssrBoot-GX8WHyxq.js";import"./VAvatar-iXQkcGmt.js";import"./VDivider-IGpMMh-l.js";import"./VField-2MQrz8bF.js";import"./form-Fs2--v9g.js";import"./VCheckboxBtn--yVtLh1Z.js";import"./VChip--5OHLTbF.js";const j=s("i",{class:"ri-add-circle-line"},null,-1),J={class:"d-flex justify-end"},K=["v-if"],X=s("tr",null,[s("th",null," Id "),s("th",null," fullname "),s("th",null," gender "),s("th",null," phone "),s("th",null," email "),s("th",null," relationship "),s("th",null," edit "),s("th",null," remove ")],-1),Z=s("i",{class:"ri-edit-line"},null,-1),Q={__name:"GuardiansForm",setup(R){let f=D().currentRoute.value.query.admNo;const a=p({showForm:!1,admNo:f,fullName:"",idNo:"",gender:"",phone:"",email:"",relationship:"",editing:!1,num:""}),V=()=>{a.value.showForm=!1},n=()=>{a.value.showForm=!0};let c=window.location.protocol+"//"+window.location.hostname+":8080";const v=p({data:[]}),b=()=>{y.get(c+`/api/v1/guardian/viewStudentGuardians/${f}`,{headers:{Authorization:C.get("Authorization")}}).then(o=>{console.log(o),v.value.data=o.data})};b();const N=()=>{a.value.admNo=f;let o=c+"/api/v1/guardian/addGuardian";a.value.editing==!0&&(o=c+`/api/v1/guardian/updateGuardian/${a.value.num}`),y[a.value.editing==!0?"put":"post"](o,a.value,{headers:{Authorization:C.get("Authorization")}}).then(l=>{console.log(l),v.value.data=l.data,b(),V(),a.value={editing:!1,showForm:!1,admNo:f}}).catch(l=>{console.log(l),alert("error : "+l.response.data)})},A=o=>{console.log(o),a.value=o,a.value.editing=!0,a.admNo=f,console.log(a.value),n()},i=o=>{console.log(o),confirm("Are you sure you want to delete?")&&y.get(c+`/api/v1/guardian/deleteGuardian/${o.num}`,{headers:{Authorization:C.get("Authorization")}}).then(l=>{b()})};return(o,l)=>{const k=z("VCardBody");return w(),S("div",null,[e(F,null,{default:r(()=>[e(u,null,{default:r(()=>[e(_,{onClick:l[0]||(l[0]=d=>{a.value={},t(a).showForm=!0,t(a).editing=!1}),color:"primary",class:"m-auto d-block"},{default:r(()=>[j,h(" Add Guardian ")]),_:1})]),_:1}),e(Y,{modelValue:t(a).showForm,"onUpdate:modelValue":l[7]||(l[7]=d=>t(a).showForm=d),"max-width":"500px"},{default:r(()=>[e(B,null,{default:r(()=>[e(T,null,{default:r(()=>[h("Add Guardian")]),_:1}),e(k,{class:"p-3"},{default:r(()=>[e(u,null,{default:r(()=>[e(m,{modelValue:t(a).fullName,"onUpdate:modelValue":l[1]||(l[1]=d=>t(a).fullName=d),label:"Guardian Name"},null,8,["modelValue"])]),_:1}),e(u,null,{default:r(()=>[e(m,{modelValue:t(a).idNo,"onUpdate:modelValue":l[2]||(l[2]=d=>t(a).idNo=d),label:"Guardian Id"},null,8,["modelValue"])]),_:1}),e(u,null,{default:r(()=>[e(m,{modelValue:t(a).email,"onUpdate:modelValue":l[3]||(l[3]=d=>t(a).email=d),label:"Guardian Email",type:"email"},null,8,["modelValue"])]),_:1}),e(u,null,{default:r(()=>[e(m,{modelValue:t(a).phone,"onUpdate:modelValue":l[4]||(l[4]=d=>t(a).phone=d),label:"Guardian Phone",type:"tel"},null,8,["modelValue"])]),_:1}),e(u,null,{default:r(()=>[e(U,{modelValue:t(a).gender,"onUpdate:modelValue":l[5]||(l[5]=d=>t(a).gender=d),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(u,null,{default:r(()=>[e(U,{modelValue:t(a).relationship,"onUpdate:modelValue":l[6]||(l[6]=d=>t(a).relationship=d),label:"Relationship",items:["FATHER","MOTHER","SPONSOR","OTHER"],placeholder:"Select Relationship",required:""},null,8,["modelValue"])]),_:1}),s("div",J,[e(_,{onClick:N},{default:r(()=>[h("Submit")]),_:1}),e(_,{onClick:V},{default:r(()=>[h("Cancel")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(q,null,{default:r(()=>[s("tbody",{"v-if":t(v).data!=null},[X,(w(!0),S(M,null,I(t(v).data,d=>(w(),S("tr",{key:d.num},[s("td",null,g(d.idNo),1),s("td",null,g(d.fullName),1),s("td",null,g(d.gender),1),s("td",null,g(d.phone),1),s("td",null,g(d.email),1),s("td",null,g(d.relationship),1),s("td",null,[e(_,{text:"edit",icon:"ri-edit-line",onClick:E=>A(d)},{default:r(()=>[Z]),_:2},1032,["onClick"])]),s("td",null,[e(_,{text:"delete",onClick:E=>i(d),icon:"ri-close-line",color:"danger"},null,8,["onClick"])])]))),128))],8,K)]),_:1})])}}},W={class:"text-h6 font-weight-semibold text-error"},ke={__name:"editStudent",setup(R){const x=D(),f={admNo:"",surname:"",firstName:"",otherName:"",dateOfBirth:"",birthCertno:"",nemisNo:"",gender:"",stream:"",stage:"",kcpeMarks:"",cohort:""},a=p({registerError:"",dateOfBirth:""});let V=!1;p();const n=p(structuredClone(f));p(!1);let c=window.location.protocol+"//"+window.location.hostname+":8080";const v=p({admNo:"",name:""}),b=x.currentRoute.value.query.admNo;let N=p({data:0});const A=async()=>{if(console.log(n.value.gender),n.value.gender==""||n.value.gender==null){a.value.registerError="You must select gender";return}V=!0,n.value.dateOfBirth=new Date(a.value.dateOfBirth);try{const i=await y.put(c+`/api/v1/student/updateStudent/${b}`,n.value,{headers:{"Content-Type":"application/json",Authorization:C.get("Authorization")}});V=!1,a.value.registerError="",console.log(v),N.value.data=new Date().getTime(),setTimeout(()=>{N.value.data=0},3e3),console.log("Success:",i.data)}catch(i){if(N.value.data=0,V=!1,console.log(i.response),a.value.registerError=i.response.data,i.response.status==403&&window.open("/","_blank"),i.response.status==400)try{a.value.registerError="";for(const[o,l]of Object.entries(JSON.parse(i.response.data.message).fielderrors))a.value.registerError+=` ${l}
`}catch{a.value.registerError=i.response.data}else a.value.registerError=i.response.data;console.log(a.value.registerError)}};return y.get(c+`/api/v1/student/viewStudent/${b}`,{headers:{Authorization:C.get("Authorization")}}).then(i=>{console.log(i);var o=i.data.body;console.log(o);const l=new Date(o.dateOfBirth),k=String(l.getDate()).padStart(2,"0"),d=String(l.getMonth()+1).padStart(2,"0"),E=l.getFullYear();o.dateOfBirth=`${k}-${d}-${E}`,a.value.dateOfBirth=`${E}-${d}-${k}`,console.log(a.value.dateOfBirth),n.value=o}).catch(i=>{console.error("Error fetching student details:",i),console.log(i),i.response&&(i.response.status===401||i.response.status===403)&&window.open("/login","_blank")}),(i,o)=>(w(),S(M,null,[e(F,null,{default:r(()=>[e(u,{cols:"12",class:"text-center"},{default:r(()=>[s("p",W,g(t(a).registerError),1)]),_:1}),t(V)?(w(),O(L,{key:0,indeterminate:"",color:"blue",size:"24",style:{position:"absolute","inset-block-start":"50%","inset-inline-start":"50%",transform:"translate(-50%, -50%)"}})):G("",!0),t(N).data>0?(w(),O(H,{key:1},{default:r(()=>[h(" Updated Successsfully ")]),_:1})):G("",!0),e(u,{cols:"12"},{default:r(()=>[e(B,{title:"Edit Student Details"},{default:r(()=>[e($,{class:"d-flex"},{default:r(()=>[e(P,{class:"mt-6"},{default:r(()=>[e(F,null,{default:r(()=>[e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).admNo,"onUpdate:modelValue":o[0]||(o[0]=l=>t(n).admNo=l),label:"Admission Number",type:"number"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).surname,"onUpdate:modelValue":o[1]||(o[1]=l=>t(n).surname=l),label:"Surname"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).firstName,"onUpdate:modelValue":o[2]||(o[2]=l=>t(n).firstName=l),label:"First Name"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).otherName,"onUpdate:modelValue":o[3]||(o[3]=l=>t(n).otherName=l),label:"Other Name"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(a).dateOfBirth,"onUpdate:modelValue":o[4]||(o[4]=l=>t(a).dateOfBirth=l),label:"Date of Birth",type:"date",placeholder:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(U,{modelValue:t(n).gender,"onUpdate:modelValue":o[5]||(o[5]=l=>t(n).gender=l),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).birthCertno,"onUpdate:modelValue":o[6]||(o[6]=l=>t(n).birthCertno=l),label:"Birth Certificate Number"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).nemisNo,"onUpdate:modelValue":o[7]||(o[7]=l=>t(n).nemisNo=l),label:"nemis Number"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).stage,"onUpdate:modelValue":o[8]||(o[8]=l=>t(n).stage=l),label:"Stage (Form)",type:"number"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(U,{modelValue:t(n).stream,"onUpdate:modelValue":o[9]||(o[9]=l=>t(n).stream=l),label:"Stream",items:["A","B","C"]},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).kcpeMarks,"onUpdate:modelValue":o[10]||(o[10]=l=>t(n).kcpeMarks=l),label:"KCPE Marks",type:"number"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:r(()=>[e(m,{modelValue:t(n).cohort,"onUpdate:modelValue":o[11]||(o[11]=l=>t(n).cohort=l),label:"Cohort",type:"number"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:r(()=>[e(_,{onClick:A},{default:r(()=>[h("Save Changes")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(F,null,{default:r(()=>[e(u,null,{default:r(()=>[e(B,null,{default:r(()=>[e(T,null,{default:r(()=>[h(" Guardians ")]),_:1}),e($,null,{default:r(()=>[e(Q)]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{ke as default};
