import{Q as O,r as d,R as y,c as U,n as e,m as t,u as r,i as G,F as S,o as g,a as n,t as x,l as T,Z as z,b as m,V as b,a2 as p,a3 as M,a4 as $,a1 as J}from"./index-Cp0a3j5Z.js";import{a as w}from"./axios-G2rPRu76.js";import{V as E,a as u}from"./VRow-e59EUwGS.js";import{V as q}from"./VDialog-xBvQGnoj.js";import{V as F}from"./VAlert-bEwvtgot.js";import{a as D,b as j,V as A,c as H,d as K}from"./VCard-f1nee6yo.js";import{V as P}from"./VSpacer-m-kjo5WO.js";import{V as Q}from"./VAvatar-MKe1hS_I.js";import{V as Y}from"./VDivider-t6YFHrqH.js";import{V as Z}from"./VForm-vHiLR6LN.js";import{V as k}from"./VTextField-74eHDJAa.js";import{V as W}from"./VSelect-Jx7iHon2.js";/* empty css              */import"./VOverlay-x4J7jcA1.js";import"./easing-Apq16fr0.js";import"./lazy-Pl5wsFII.js";import"./VImg-xuUNPkdI.js";import"./forwardRefs-y8pOSn8h.js";import"./dialog-transition-VPrIJniv.js";import"./form-xXdqDCjs.js";import"./VField-thFyAEi-.js";import"./index-ogFRjp9r.js";import"./VLabel-X25Up-Eg.js";import"./VMenu-RzLdOBfR.js";import"./ssrBoot-DBy9na19.js";import"./VCheckboxBtn-z-5o5nyt.js";import"./VChip-8MtU5gPv.js";const X={class:"text-h6 font-weight-semibold text-error"},ee={class:"d-flex flex-column justify-center gap-5"},te={class:"d-flex flex-wrap gap-2"},ae=n("span",{class:"d-none d-sm-block"},"Select new photo",-1),le=n("span",{class:"d-none d-sm-block"},"Reset",-1),oe=n("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF or PNG. Max size of 800K ",-1),se={class:"d-none d-sm-block"},re={class:"text-left pl-4"},De={__name:"account-settings",setup(ne){O();const C={avatarImg:""},i=d({registerError:"",dateOfBirth:""});let V=!1;const v=d(),s=d(structuredClone(C));d(!1);const L=l=>{const a=new FileReader,{files:o}=l.target;o&&o.length&&(a.readAsDataURL(o[0]),a.onload=()=>{typeof a.result=="string"&&(s.value.avatarImg=a.result)})},I=()=>{s.value.avatarImg=C.avatarImg};let _=window.location.protocol+"//"+window.location.hostname+":8080",h=d({data:0});const B=async()=>{if(s.value.fullname=s.value.fname,console.log(s.value.gender),s.value.gender==""||s.value.gender==null){i.value.registerError="You must select gender";return}V=!0;try{const l=await w.put(_+"/api/v1/user/updateUser",s.value,{headers:{"Content-Type":"application/json",Authorization:y.get("Authorization")}});V=!1,i.value.registerError="",h.value.data=new Date().getTime(),setTimeout(()=>{h.value.data=0},3e3),console.log("Success:",l.data)}catch(l){if(h.value.data=0,V=!1,console.log(l.response),i.value.registerError=l.response.data,l.response.status==403&&window.open("/","_blank"),l.response.status==400)try{i.value.registerError="";for(const[a,o]of Object.entries(JSON.parse(l.response.data.message).fielderrors))i.value.registerError+=` ${o}
`}catch{i.value.registerError=l.response.data}else i.value.registerError=l.response.data;console.log(i.value.registerError)}};w.get(_+"/api/v1/user/userInfo",{headers:{Authorization:y.get("Authorization")}}).then(l=>{console.log(l),s.value=l.data}).catch(l=>{console.error("Error fetching student details:",l),console.log(l),l.response&&(l.response.status===401||l.response.status===403)&&window.open("/login","_blank")}),w.get(_+"/api/v1/UserPhoto/getUserPhoto",{responseType:"blob",headers:{Authorization:y.get("Authorization")}}).then(l=>{const a=new Blob([l.data],{type:"application/png"});C.avatarImg=URL.createObjectURL(a),I()});const c=d({success:!1}),N=()=>{console.log(v.value.value);const l=new FormData;l.append("file",v.value.files[0]),console.log(Object.keys(l)),console.log(Object.values(l)),w.post(_+"/api/v1/UserPhoto/uploadUserPhoto",l,{headers:{"Content-Type":"multipart/form-data",Authorization:y.get("Authorization")}}).then(a=>{c.value.success=!0,window.setTimeout(()=>{c.value.success=!1},3e3)})},f=d(!1);return(l,a)=>(g(),U(S,null,[e(E,null,{default:t(()=>[e(u,{cols:"12",class:"text-center"},{default:t(()=>[n("p",X,x(r(i).registerError),1)]),_:1}),r(V)?(g(),T(J,{key:0,indeterminate:"",color:"blue",size:"24",style:{position:"absolute","inset-block-start":"50%","inset-inline-start":"50%",transform:"translate(-50%, -50%)"}})):z("",!0),r(h).data>0?(g(),T(F,{key:1},{default:t(()=>[m(" Updated Successsfully ")]),_:1})):z("",!0),e(u,{cols:"12"},{default:t(()=>[e(D,null,{default:t(()=>[e(j,null,{default:t(()=>[e(b,{icon:"ri-group-line"}),m(" Edit Account Details ")]),_:1}),e(P),e(P),e(A,{class:"d-flex"},{default:t(()=>[e(Q,{rounded:"lg",size:"100",class:"me-6",image:r(s).avatarImg},null,8,["image"]),n("form",ee,[n("div",te,[e(p,{color:"primary",onClick:a[0]||(a[0]=o=>{var R;return(R=r(v))==null?void 0:R.click()}),variant:"outlined"},{default:t(()=>[e(b,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),ae]),_:1}),n("input",{ref_key:"refInputEl",ref:v,type:"file",name:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:L},null,544),e(p,{type:"reset",color:"error",variant:"outlined",onClick:I},{default:t(()=>[le,e(b,{icon:"ri-refresh-line",class:"d-sm-none"})]),_:1})]),oe,e(p,{color:r(c).success?"success":"primary",onClick:N,modelValue:r(c).success,"onUpdate:modelValue":a[1]||(a[1]=o=>r(c).success=o)},{default:t(()=>[e(b,{icon:"ri-upload-cloud-line",class:"d-sm-none"}),n("span",se,x(r(c).success?"Uploaded Successfully":"Upload photo"),1)]),_:1},8,["color","modelValue"])])]),_:1}),e(Y),e(H,{class:"d-flex w-100"},{default:t(()=>[e(E,{class:"d-flex w-100"},{default:t(()=>[e(u,{md:"6",cols:"12"},{default:t(()=>[e(F,null,{default:t(()=>[n("span",null,[m("User Type: "),n("b",null,x(r(s).rolesCategory),1)])]),_:1})]),_:1}),e(u,{md:"6",cols:"12",class:"d-flex m-auto"},{default:t(()=>[e(p,{text:"View My Roles",class:"d-flex mt-2",onClick:a[2]||(a[2]=M(o=>f.value=!0,["prevent"]))})]),_:1})]),_:1})]),_:1}),e(A,{class:"d-flex"},{default:t(()=>[e(Z,{class:"mt-6"},{default:t(()=>[e(E,null,{default:t(()=>[e(u,{md:"6",cols:"12"},{default:t(()=>[e(k,{modelValue:r(s).fname,"onUpdate:modelValue":a[3]||(a[3]=o=>r(s).fname=o),label:"Full Name",type:"text"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:t(()=>[e(k,{modelValue:r(s).username,"onUpdate:modelValue":a[4]||(a[4]=o=>r(s).username=o),label:"Username"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:t(()=>[e(W,{modelValue:r(s).gender,"onUpdate:modelValue":a[5]||(a[5]=o=>r(s).gender=o),label:"Gender",items:["MALE","FEMALE","OTHER"],placeholder:"Select Gender",required:""},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:t(()=>[e(k,{modelValue:r(s).email,"onUpdate:modelValue":a[6]||(a[6]=o=>r(s).email=o),label:"Email",type:"email"},null,8,["modelValue"])]),_:1}),e(u,{md:"6",cols:"12"},{default:t(()=>[e(k,{modelValue:r(s).phone,"onUpdate:modelValue":a[7]||(a[7]=o=>r(s).phone=o),label:"Phone",type:"tel"},null,8,["modelValue"])]),_:1}),e(u,{cols:"12",class:"d-flex flex-wrap gap-4"},{default:t(()=>[e(p,{onClick:B},{default:t(()=>[m("Save Changes")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(q,{modelValue:r(f),"onUpdate:modelValue":a[9]||(a[9]=o=>G(f)?f.value=o:null),"max-width":"500px",class:"text-center"},{default:t(()=>[e(D,null,{default:t(()=>[e(j,{class:"text-h6 font-weight-bold"},{default:t(()=>[m("My Roles")]),_:1}),e(A,null,{default:t(()=>[n("ol",re,[(g(!0),U(S,null,$(r(s).roles,o=>(g(),U("li",{key:o},x(o),1))),128))])]),_:1}),e(K,{class:"justify-center"},{default:t(()=>[e(p,{color:"primary",onClick:a[8]||(a[8]=o=>f.value=!1)},{default:t(()=>[m("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{De as default};
