import{a as b}from"./axios-G2rPRu76.js";import{_ as Z,X as G,r as p,Y as w,c as f,b as e,w as t,o as i,B as d,t as h,u as o,a2 as x,V as J,F as E,a4 as D,e as $,a as z,Z as S,p as K,m as P}from"./index--uHrWztf.js";import{V as m,a as n}from"./VRow-C1Q3znKN.js";import{a as A,b as j,V as F,c as Q}from"./VCard-zro6p-jn.js";import{V as q}from"./VForm-2G8_3d_f.js";import{V as W}from"./VSelect-EssjzhX8.js";import{V as ee}from"./VDialog-XJY_jqiP.js";import{V as ae}from"./VSpacer-k862SYs1.js";import{V as te}from"./VCheckbox-B_zzIWl6.js";import{V as O}from"./VTextField-YveBRxC6.js";import{V as le}from"./VDataTable-_V6xC0V4.js";/* empty css              */import"./VAvatar-UovGB6ZZ.js";import"./VImg-T1wKAj7l.js";import"./form-gRAo9SrI.js";import"./forwardRefs-y8pOSn8h.js";import"./VMenu-Fh5_tsfm.js";import"./index-EqZBXuIc.js";import"./ssrBoot-YvMPSAVD.js";import"./VDivider-rjHNxqrv.js";import"./VOverlay-Ko1djXxg.js";import"./easing-imumzmxr.js";import"./lazy-sG_msKxB.js";import"./VCheckboxBtn-k6b5wbXb.js";import"./VField-A8xS_5ao.js";import"./VChip-0IljYP5g.js";import"./VTable-ZP4PhMxV.js";const oe=y=>(K("data-v-c87331f4"),y=y(),P(),y),re=oe(()=>z("p",null,[z("strong",null,"Marks")],-1)),se={key:0},ue={__name:"editMarksSheet",setup(y){const U=G();let v=window.location.protocol+"//"+window.location.hostname+":8080",I=U.currentRoute.value.query.exam,M=U.currentRoute.value.query.stage;const _=p({data:"All"}),V=p({data:[],showForm:!1}),C=p({year:2024,term:"",title:""}),g=p({data:[]}),c=p({data:[],filtered:[],search:""});b.get(v+`/api/v1/examination/viewExamination/${I}`,{headers:{Authorization:w.get("Authorization")}}).then(r=>{C.value=r.data});const u=p({data:[],visible:[]});let N=[];const k=new Map;b.get(v+"/api/v1/subjectSelection/availableSubjects",{headers:{Authorization:w.get("Authorization")}}).then(r=>{console.log(r),N=r.data,N.forEach(l=>{k.set(l.subjectCode,{subjectName:l.subjectName,subjectRep:l.subjectRep})}),console.log(k),console.log(k.get(101))}),b.get(v+`/api/v1/marks/viewMarksSheet/${I}/${M}`,{headers:{Authorization:w.get("Authorization")}}).then(r=>{console.log(r);var a=Object.keys(r.data[0]);console.log(a);for(var l=0;l<a.length-1;l++)a[l]!="examination"&&u.value.data.push({title:a[l],value:a[l],align:"center",show:!0,type:1,key:a[l]});for(var a=Object.keys(r.data[0].marks),l=0;l<a.length;l++)u.value.data.push({title:k.get(parseInt(a[l])).subjectName+"("+a[l]+")",value:a[l],show:!1,type:2,key:"marks."+a[l]+".marks"});console.log(u.value.data),c.value.data=r.data,c.value.filtered=r.data,V.value.data=u,B()});const Y=r=>{b.put(v+"/api/v1/marks/updateMarks",r,{headers:{Authorization:w.get("Authorization")}}).then(l=>{console.log(l)}).catch(l=>{console.log(l),g.value.data.push(r)})},H=async()=>{for(var r=[],l=0;l<g.value.data.length;l++){const a=g.value.data[l];try{const s=await b.put(v+"/api/v1/marks/updateMarks",a,{headers:{Authorization:w.get("Authorization")}});(s.status===200||s.ok)&&r.push(l)}catch(s){console.error(s)}}r.reverse().forEach(a=>{g.value.data.splice(a,1)})},L=()=>{V.value.showForm=!0},R=()=>{V.value.showForm=!1},B=()=>{u.value.visible=[];for(const r in u.value.data)u.value.data[r].show&&u.value.visible.push(u.value.data[r]);console.log(u.value.visible)},X=()=>{R(),B()};return(r,l)=>(i(),f("div",null,[e(m,null,{default:t(()=>[e(n,null,{default:t(()=>[e(A,null,{default:t(()=>[e(j,null,{default:t(()=>[d(" Exarm Information ")]),_:1}),e(F,null,{default:t(()=>[e(q,null,{default:t(()=>[e(m,null,{default:t(()=>[e(n,{md:"6",cols:"12"},{default:t(()=>[d(h(o(C).title),1)]),_:1}),e(n,{md:"6",cols:"12"},{default:t(()=>[d(" Year : "+h(o(C).year),1)]),_:1}),e(n,{md:"6",cols:"12"},{default:t(()=>[d(" Form "+h(o(M)),1)]),_:1}),e(n,{md:"6",cols:"12"},{default:t(()=>[d(" Term "+h(o(C).term),1)]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(n,null,{default:t(()=>[e(W,{label:"Stream",placeholder:"Select Stream",items:["All","A","B","C"],value:"All",modelValue:o(_).data,"onUpdate:modelValue":l[0]||(l[0]=a=>o(_).data=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(n,null,{default:t(()=>[e(A,null,{default:t(()=>[e(j,null,{default:t(()=>[e(m,null,{default:t(()=>[e(n,null,{default:t(()=>[re]),_:1}),e(n,null,{default:t(()=>[e(m,null,{default:t(()=>[d(h(o(g).data.length)+" Unsaved Changes ",1)]),_:1}),e(m,null,{default:t(()=>[e(x,{text:"Save Changes",onClick:H})]),_:1})]),_:1}),e(n,null,{default:t(()=>[e(x,{color:"success",onClick:L},{default:t(()=>[d("viewable Columns")]),_:1})]),_:1})]),_:1})]),_:1}),e(ee,{modelValue:o(V).showForm,"onUpdate:modelValue":l[1]||(l[1]=a=>o(V).showForm=a),"max-width":"600"},{default:t(()=>[e(A,null,{default:t(()=>[e(j,null,{default:t(()=>[d(" Form "),e(ae),e(x,{icon:"",onClick:R},{default:t(()=>[e(J,null,{default:t(()=>[d("ri-close-line")]),_:1})]),_:1})]),_:1}),e(F,null,{default:t(()=>[e(q,null,{default:t(()=>[(i(!0),f(E,null,D(o(u).data,a=>(i(),$(m,{key:a.value},{default:t(()=>[z("span",null,[e(te,{label:a.title,"v-text":a.title,modelValue:a.show,"onUpdate:modelValue":s=>a.show=s},null,8,["label","v-text","modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))]),_:1})]),_:1}),e(Q,null,{default:t(()=>[e(x,{onClick:X},{default:t(()=>[d("Submit")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(F,null,{default:t(()=>[e(n,null,{default:t(()=>[e(O,{modelValue:o(c).search,"onUpdate:modelValue":l[2]||(l[2]=a=>o(c).search=a),label:"Search",clearable:""},null,8,["modelValue"])]),_:1}),e(le,{items:o(c).filtered,search:o(c).search,class:"elevation-1",striped:"","items-per-page":o(_).data=="All"?10:o(c).filtered.length,headers:o(u).visible},{item:t(({item:a})=>[o(_).data=="All"||o(_).data==a.stream?(i(),f("tr",{key:a.admNo},[(i(!0),f(E,null,D(o(u).visible,s=>(i(),f("td",{key:s.key,align:"center",width:160,dense:"",style:{"inline-size":"2rem"}},[s.type==1?(i(),f("span",se,h(a[s.key]),1)):S("",!0),s.type==2?(i(),$(O,{key:1,modelValue:a.marks[s.value].marks,"onUpdate:modelValue":T=>a.marks[s.value].marks=T,label:o(k).get(a.marks[s.value].subjectCode).subjectRep+"("+a.admNo+")",onChange:T=>Y(a.marks[s.value])},null,8,["modelValue","onUpdate:modelValue","label","onChange"])):S("",!0)]))),128))])):S("",!0)]),_:1},8,["items","search","items-per-page","headers"])]),_:1})]),_:1})]),_:1})]),_:1})]))}},Re=Z(ue,[["__scopeId","data-v-c87331f4"]]);export{Re as default};
